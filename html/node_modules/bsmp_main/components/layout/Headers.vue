<template>
  <header class="header header-fixed">
    <div class="navbar-header pull-left">
      <a href="#/index" class="navbar-brand">
        <small>
          <img v-if="companyId === 'vc2c'" src="/static/images/superbee_logo.png" alt="" width="150">
          <img v-else src="/static/images/logo-h.png" alt="">
        </small>
      </a>
    </div>
    <div class="module-select" v-show="modules.items && modules.items.length > 1 && roleCode && roleCode !== 'ALL'">
      <el-dropdown @command="switchModule" menu-align="start">
        <el-button type="primary">
          {{moduleName}}
          <!-- <i class="el-icon-caret-bottom el-icon--right"></i> -->
        </el-button>
        <el-dropdown-menu slot="dropdown" class="module-dropdown">
          <el-dropdown-item v-for="(m, index) in modules.items" :command="m.key"
                            :divided="index !== 0"
                            :disabled="focusModule === m.key" :key="'module-'+ m.key">{{m.name}}</el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
    </div>
    <div class="navbar-header pull-right">
      <div class="navbar-account">
        <ul class="account-area" v-click-outside="hide">
          <li @click.stop="switchNav('1')" :class="{open: active === '1'}">
            <!--<a class="wave in dropdown-toggle" data-toggle="dropdown" title="Help" href="javascript:void(0)">-->
              <!--<i class="icon icon-mail-alt"></i>-->
              <!--<span class="badge">3</span>-->
            <!--</a>-->
            <a title="公司切换" v-show="roleCode === 'ALL'"
               class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)">
              <i class="icon icon-menu"></i>
            </a>
            <!--Messages Dropdown-->
            <ul class="pull-right dropdown-menu dropdown-arrow dropdown-messages">
              <li>
                <div class="item-title">公司切换</div>
                <div class="item-body">
                  <span @click="switchCompany(c)" v-for="c in companies"
                        :class="{in: company && company.companyId === c.companyId}">{{c.name}}</span>
                </div>
              </li>
            </ul>
            <!--/Messages Dropdown-->
          </li>

          <li @click.stop="switchNav('2')" :class="{open: active === '2'}">
            <a class="login-area dropdown-toggle" data-toggle="dropdown">
              <div class="avatar" title="View your public profile">
                <img src="../../assets/avatars/admin.png">
              </div>
              <section>
                <h2><span class="profile"><span>{{loginUserInfo.name}}</span></span></h2>
              </section>
            </a>
            <!--Login Area Dropdown-->
            <ul class="pull-right dropdown-menu dropdown-arrow dropdown-login-area">
              <!--Avatar Area-->
              <li v-show="roleCode && roleCode !== 'ALL'" class="pwd">
                <a @click="showPwdDialog" title="修改密码"><i class="icon-key"></i></a></li>
              <li class="dropdown-footer">
                <a href="javascript:void(0);" @click="logout"><i class="icon-logout logout"></i>
                  退出
                </a>
              </li>
            </ul>
            <!--/Login Area Dropdown-->
          </li>
          <!-- /Account Area -->
          <!--Note: notice that setting div must start right after account area list.
          no space must be between these elements-->
          <!-- Settings -->
        </ul>
      </div>
    </div>
  </header>
</template>
<script>
  export default {
    name: 'Headers',
    props: {
      loginUserInfo: {
        type: Object
      },
      companies: {
        type: Array
      },
      company: {
        type: Object
      },
      modules: {
        type: Object
      }
    },
    data () {
      return {
        active: null,
        moduleKey: '',
        pageMap: {
          'vc2c': {
            title: 'SBC后台',
            icon: '/static/superbee_logo.png'
          }
        }
      };
    },
    computed: {
      roleCode() {
        if (this.loginUserInfo && this.loginUserInfo.roleCode) {
          return this.loginUserInfo.roleCode;
        }
        return ''
      },
      companyId() {
        if (this.loginUserInfo && this.loginUserInfo.companyId) {

          // 页面 title，icon设置
          let page = this.pageMap[this.loginUserInfo.companyId];
          if (page) {
            document.title = page.title;
            let links = document.getElementsByTagName('link');
            for (let i = 0, len = links.length; i < len; i++) {
              if (links[i].rel === 'shortcut icon') {
                links[i].href = page.icon;
              }
            }
          }
          return this.loginUserInfo.companyId;
        }
        return ''
      },
      focusModule() {
        if (!this.moduleKey) {
          window.sessionStorage.setItem('systemFlag', this.modules.focus);
          return this.modules.focus;
        }
        return this.moduleKey
      },
      moduleName() {
        let name = '';
        if (this.modules && this.modules.items) {
          for (let i = 0, len = this.modules.items.length; i < len; i++) {
            if (this.modules.items[i].key === this.focusModule) {
              name = this.modules.items[i].name;
              break;
            }
          }
        }
        return name;
      }
    },
    methods: {
      switchModule(key) {
        this.moduleKey = key;
        this.$emit('switchModule', key);
      },
      showPwdDialog() {
        this.$emit('showPwdDialog');
      },
      switchCompany(item) {
        this.$emit('switchCompany', item);
      },
      switchNav (key) {
        if (this.active === key) {
          this.active = '0';
        } else {
          this.active = key;
        }
      },
      hide() {
        this.active = '0';
      },
      logout () {
        this.$emit('logout');
      }
    }
  };
</script>
<style lang="stylus" scoped>
  .module-select
    margin-left: 70px
    float: left
    .el-button
      padding: 14px 15px !important
      background: transparent !important
      border: none !important
      border-radius: 0 !important
      .el-icon-caret-bottom:before
        font-family: "iconfont"
        font-size: 15px
        content: '\e80f'
  .module-dropdown 
    background: #002140 !important;
    color: #fff;
    border: none;
    .el-dropdown-menu__item
      &:hover 
        background: #48576a !important;
        color: #fff;
    .el-dropdown-menu__item--divided
      border-top: none
      &:before
        display:none !important
  @keyframes wave
    5%
      opacity: .6
    27%
      transform: scale(1.8)
      opacity: 0
    100%
      opacity: 0

  @keyframes dropdownSlideInDown
    0%
      opacity: 0
      transform: translateY(-20px)
    100%
      transform: translateY(0)

  .dropdown-menu
    border: 1px solid #ccc!important
    border-radius: 2px!important
    background-clip: padding-box!important
    box-shadow: 0 2px 40px rgba(0,0,0,.4)
    transition: opacity .218s
    margin: 1px 0 0
    min-width: 170px

  .dropdown-menu.pull-right
    left: auto
    right: 0

  header
    z-index: 1000
    transition: all .5s ease
    border-top: 1px solid #3091f2
    background-color: #fff
    box-shadow: 0 2px 4px 0 rgba(0,0,0,.12), 0 0 6px 0 rgba(0,0,0,.04)
    &.header-fixed
      position: fixed
      top: 0
      left: 0
      right: 0
      height: 47px
      background: #002140
  .navbar-header
    padding-left: 5px
    width: 150px
    margin-top: 7px;
    img
      height: 37px
      width: 127px
    .navbar-account
      height: 45px
      .account-area
        transition: .9s
        transform-style: preserve-3d
        backface-visibility: hidden
        position: absolute
        top: 0
        right: 50px
        opacity: 1
        list-style: none
        margin-bottom: 0
        display: inline-block
        margin-top: 0
        box-sizing: border-box
        >li
          float: left
          position: relative
          height: 45px
          &.open>a
            background-color: #002140
            box-shadow: 0 2px 40px rgba(0,0,0,.4)
          &.open .dropdown-menu
            margin-top: 0
            right: 0
            border: 0!important
            display: block
          a
            position: relative
            min-width: 50px
            height: 45px
            display: inline-block
            color: #428bca
            text-decoration: none
          .wave
            transform: scale(0)
            overflow: visible
            cursor: pointer
            z-index: 10
            box-sizing: border-box
            transition: transform .3s cubic-bezier(.68,-.55,.265,1.55)
            &.in
              transform: scale(1)
              &:after
                content: ""
                top: 3px
                left: 0
                position: absolute
                width: 40px
                height: 40px
                background-image: radial-gradient(center center,farthest-side circle,rgba(26,175,93,0) 70%,#f5f5f5 100%)
                border: 1px solid #fff
                animation: wave 5s 3s infinite linear
                opacity: 0
                border-radius: 50%
                background-clip: padding-box
                box-sizing: border-box
          .icon
            display: block
            color: #fff
            font-size: 16px
            line-height: 48px
            text-align: center
            transition: line-height .3s ease
          .badge
            position: absolute
            top: 6px
            left: 4px
            padding: 2px
            cursor: pointer
            background-color: transparent!important
            border: 1px solid #fff
            width: 18px
            height: 18px
            box-shadow: 1px 1px 0 #4096FF
            transition: top .3s ease
          .dropdown-menu
            padding: 0
            min-width: 240px
            animation-name: dropdownSlideInDown
            animation-duration: .3s
            border-radius: 0!important
            background-clip: padding-box!important
            li
              background-color: #fff
              border: 0
            &.dropdown-messages
              width: 300px
              padding-top: 10px
              li
                border-bottom: 1px solid #f3f3f3
                .item-title
                  box-shadow: 0 1px 2px rgba(0,0,0,.15);
                  padding: 5px 10px;
                  border-top: 2px solid #4096FF;
                  color: #999;
                  font-size: 12px;
                .item-body
                  border: 1px solid #eaeefb
                  padding: 5px 0
                  span
                    display: inline-block
                    width: 25%
                    height: 25px
                    margin: 5px 10px
                    padding: 3px
                    border: 1px solid #bfcbd9
                    border-radius: 4px
                    color: #1f2d3d
                    cursor: pointer
                    text-align: center
                    text-overflow:ellipsis
                    &:hover
                      color: #20a0ff
                    &.in
                      color: #fff
                      background: #20a0ff
            &.dropdown-arrow
              &:before
                border-bottom: 3px solid #fff
                border-left: 3px solid transparent
                border-right: 3px solid transparent
                content: ''
                display: none
                left: 9px
                position: absolute
                top: -46px
              &.pull-right:before
                left: auto
          .dropdown-arrow:before
            content: ''
            display: inline-block
            right: 0
            position: absolute
            width: 50px
            background-color: #fff
            border: 0
            height: 3px
            box-shadow: 0 2px 40px rgba(0,0,0,.4)
        .login-area
          padding: 8px 20px 10px 20px
          height: 45px
          opacity: 1
          position: relative
          cursor: pointer
          .avatar
            margin-top: 2px
            display: block
            float: left
            width: 30px
            height: 25px
            img
              width: 17px
              height: 14px
          section
            width: auto
            display: block
            overflow: hidden
            line-height: 25px
            float: left
            h2
              font-size: 14px
              font-weight: 400
              white-space: nowrap
              margin: 0
              span
                display: block
                color: #fff
                overflow: hidden
                text-overflow: ellipsis
                text-decoration: none
                line-height: 25px
          &+.dropdown-arrow:before
            width: 100%
          &+.dropdown-menu
            width: 100%
            min-width: 100px
        .dropdown-login-area
          >li
            border-bottom: 1px solid #f5f5f5
            &.username
              color: #d0d0d0
              font-size: 14px
              font-weight: 300
              display: none
              text-align: center
              a
                color: #d0d0d0
                font-size: 14px
                font-weight: 300
            &.pwd
              font-size: 14px
              text-align: center
              background-color: #002140;
              a
                color: #fff
                height 30px
                padding: 5px
                cursor: pointer

            .avatar-area
              position: relative
              text-align: center
              margin: 10px auto
              width: 128px
              .avatar
                width: 128px
                height: 128px
              .caption
                background-color: #4096FF
                opacity: .7
                bottom: 0
                left: 0
                color: #fff
                font-size: 10px
                line-height: 9px
                position: absolute
                padding: 7px 0
                text-align: center
                width: 128px
                cursor: pointer
            &.dropdown-footer
              padding: 10px
              border-top: 1px solid #4096FF
              border-bottom: 0
              text-align: right
              background-image: linear-gradient(to right,#ddd,#fff);
              a
                display: inline-block
                padding: 0
                color: #717171
                font-size: 13px
                font-weight: 300
                height: auto

</style>
