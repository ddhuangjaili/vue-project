<template>
  <el-row class="tac">

    <div class="icon-float" :class="{'active': collapseShow}" @click="switchCollapse">
      <i title="菜单伸缩切换" class="collapse-icon el-icon-arrow-left"
         :class="{'el-icon-arrow-right': collapseShow}"></i>
    </div>

    <!-- 菜单分类筛选 -->
    <el-col :span="24">
      <a @click="toIndex()" title="首页" class="home" href="javascript:void(0)">
        <i class="icon icon-home"></i>首页</a>
    </el-col>

    <!-- 菜单列表 -->
    <el-menu :default-active="active" :default-openeds="openeds"
             :unique-opened="true" :router="true" class="el-menu-vertical">
      <template v-for="(menu, index) in navMenus">
        <el-submenu class="top-menu" v-if="menu.children && menu.children.length"
                    :index="index + ''" :key="'menu_' + index">
          <template slot="title"><i class="icon" :class="menu.icon"></i>{{menu.name}}</template>

          <el-menu-item-group v-for="(submenu, subIndex) in menu.children" :key="'submenu_' + subIndex">
            <el-submenu v-if="submenu.children && submenu.children.length" :index="index + '-' + subIndex">
              <template slot="title"><span class="item-name">{{submenu.name}}</span></template>
              <el-menu-item v-for="(supmenu, supIndex) in submenu.children"
                            :route="{path: supmenu.path}" :key="'supmenu_' + supIndex"
                            :index="index + '-' + subIndex + '-' + supIndex"
                            :class="{'is-active': currNav && currNav === supmenu.path}">
                <span class="item-name">{{supmenu.name}}</span>
              </el-menu-item>
            </el-submenu>
            <el-menu-item v-else :route="{path: submenu.path}"
                          :index="index + '-' + subIndex" :key="'submenu_' + subIndex"
                          :class="{'is-active': currNav && currNav.path === submenu.path}">
              <span class="item-name">{{submenu.name}}</span>
            </el-menu-item>
          </el-menu-item-group>

        </el-submenu>
        <el-menu-item v-else :route="{path: menu.path}" :index="index + ''"
                      :key="'menu_' + index"
                      :class="{'is-active': currNav && currNav.path === menu.path}">
          <i :class="menu.icon"></i>{{menu.name}}

        </el-menu-item>
      </template>
    </el-menu>
    <!-- /菜单列表 -->
  </el-row>
</template>
<script>
  export default {
    name: 'Menus',
    props: {
      menus: {
        type: Array
      },
      modules: {
        type: Object
      },
      loginUserInfo: {
        type: Object
      },
      collapse: {
        type: Boolean
      }
    },
    data () {
      return {
        openeds: null,
        active: 'index',
        currNav: null
      };
    },
    computed: {
      collapseShow() {
        return this.collapse;
      },
      navMenus () {
        let mapMenus = this.getFixMenuIndex(this.menus);
        if (mapMenus && mapMenus.submenu) {
          this.openeds = [mapMenus.menuIndex + ''];
          this.active = mapMenus.menuIndex + '-' + mapMenus.submenuIndex;
        }
        return this.menus;
      }
    },
    methods: {
      switchCollapse() {
        this.$emit('collapseChange');
      },
      toIndex() {
        this.active = 'index';
        location.href = '/#/index';
      },
      focusMenu (menu, submenu, supmenu) {
        this.currNav = null;
        this.handleBreads(menu, submenu, supmenu);
      },
      handleBreads (menu, submenu, supmenu) {
        let breads = [];
        if (menu) {
          breads.push({name: menu.name, path: menu.path});
        }
        if (submenu) {
          breads.push({name: submenu.name, path: submenu.path});
        }
        if (supmenu) {
          breads.push({name: supmenu.name, path: supmenu.path});
        }
        this.$emit('breadsChange', breads);
      },
      /**
       * 当前加载地址菜单定位信息
       * @param menus
       * @returns {*}
       */
      getFixMenuIndex (menus) {
        if (!menus) {
          return null;
        }
        this.currNav = null;
        let menu = null; let submenu = null;
        let menuIndex; let submenuIndex = 0;
        for (menuIndex = 0; menuIndex < menus.length; menuIndex++) {
          menu = menus[menuIndex];
          if (menu.children && menu.children.length) {
            for (submenuIndex = 0; submenuIndex < menu.children.length; submenuIndex++) {
              submenu = menu.children[submenuIndex];
              if (this.$route.path === submenu.path) {
                this.currNav = submenu;
                break;
              }
            }
          }
          if (this.currNav) {
            break;
          }
        }

        if (this.currNav) {
          this.handleBreads(menu, submenu);
          return {
            menu: menu,
            submenu: this.currNav,
            menuIndex,
            submenuIndex
          };
        } else {
          this.handleBreads(null);
          return null;
        }
      }
    }
  };
</script>
<style lang="stylus" scoped>
  @keyframes dropdownSlideInDown
    0%
      opacity: 0
      transform: translateY(-20px)
    100%
      transform: translateY(0)
  .home
    float: left
    margin: 0 15px
    color #fff
    text-decoration:none
    &.in
      i
        color: red !important
  .icon-float
    position: absolute
    left: 195px
    top: 0
    background: #002140
    width: 25px
    height: 40px
    border-radius: 0 41px 41px 0;
    z-index: 200
    &.active
      left: 40px
  .collapse-icon
    display: inline-block
    cursor: pointer
    color: #20a0ff
    line-height: 30px
    position: relative
    transition: transform .318s ease
    font-size: 12px
    padding: 5px 0
    transform: scale(1)
    &:hover
      transform: scale(1.5)
</style>
