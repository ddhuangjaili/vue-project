<template>
  <div class="login-container">
    <img src="/static/login-bg.png" class="background-image">
    <div class="widget animated">
      <div class="widget-header">
        <p class="circle"></p>
        <p class="widget-caption">SWS智能审核系统</p>
      </div>
      <el-form v-loading="loading" :model="loginValidateForm" ref="loginValidateForm" class="widget-body">
        <el-form-item prop="name" :rules="[{ required: true, message: '账号不能为空'}]">
          <el-input @keyup.enter.native="submitForm('loginValidateForm')"
                    v-model="loginValidateForm.name" auto-complete="off" placeholder="账号"></el-input>
        </el-form-item>
        <el-form-item prop="password" :rules="[{ required: true, message: '密码不能为空'}]">
          <el-input @keyup.enter.native="submitForm('loginValidateForm')"
                    v-model="loginValidateForm.password" type="password" auto-complete="off" placeholder="密码">
          </el-input>
        </el-form-item>
        <!-- <el-form-item prop="remember">
          <el-checkbox v-model="loginValidateForm.remember">记住密码</el-checkbox>
        </el-form-item> -->
        <el-form-item>
          <a class="submit-btn" @click="submitForm('loginValidateForm')">
            立即登录
          </a>
        </el-form-item>
      </el-form>
    </div>

    <div class="bottom_describ">
      <p>深圳舍为斯科技有限公司版权所有 </p>
      <p>copyright © 2012-2019 Shenzhen Guangdong All Rights Reserved</p>
    </div>
  </div>
</template>
<script>
  import util from '../util';
  import api from '../api';
  export default {
    name: 'login',
    data () {
      return {
        loading: false,
        loginValidateForm: {
          name: '',
          password: '',
          remember: true
        }
      };
    },
    mounted () {

      let params = window.sessionStorage.getItem('remember');
      if (params) {
        params = JSON.parse(params);
        if (params.name) {
          this.loginValidateForm.name = params.name
        }
        if (params.password) {
          this.loginValidateForm.password = params.password
        }
        if (params.remember) {
          this.loginValidateForm.remember = params.remember
        }
      }
    },
    methods: {
      submitForm (formName) {
        this.$refs[formName].validate((valid) => {
          if (valid) {
            this.loading = true;
            api.login(this.loginValidateForm).then((res) => {
              this.loading = false;
              let data = res.data;
              if (data && data.code === '0') {
                this.$store.commit('CLEAR_FUNCS');
                this.$store.commit('LOGIN_SUCCESS', res.data);

                // 记录日志
                api.log({
                  component: 'bsmp',
                  type: 'login',
                  content: 'name:' + res.data.data.loginName
                });
                this.$router.push('/index');

              } else {
                this.$message({
                  type: 'warning',
                  message: data.msg || '登录失败！'
                });
              }
            }).catch((error) => {
              if (error.msg) {
                this.$message({
                  type: 'warning',
                  message: error.msg
                });
              }
            });
          } else {
            return false;
          }
        });
      }
    }
  };
</script>
<style lang="stylus" scoped>
  .login-container 
    position: relative
    width 100%
    height 100%
    .background-image {
      width: 100%;
      margin: 0 auto;
    }
    .bottom_describ {
      margin: 20px 0;
      text-align: center;
      font-size: 12px;
      color: #b5b5b6;
    }
  .widget
    box-shadow: 0 16px 28px 0 rgba(0,0,0,0.22), 0 25px 55px 0 rgba(0,0,0,0.21);
    max-width: 300px
    background: #fff
    position absolute
    right: 10%;
    top: 20%;
    border-radius: 5px;

    .widget-header
      padding: 15px 10px
      text-align: center
      overflow hidden;
      .circle
        width: 50px
        height: 50px
        margin-left: 20px;
        border-radius: 50%;
        float left;
        overflow: hidden
        background: url("/static/images/login-logo.png")
        background-size: 100% 100%

      .widget-caption
        line-height: 50px
        padding: 0
        margin: 0
        font-size: 16px
        float left;
        margin-left 15px;

  .widget-body
    padding: 10px 50px 10px
    text-align: left
  .animated
    animation-duration: 1s
    animation-fill-mode: both

  .submit-btn
    background: #58B7FF
    display: inline-block
    width: 100%
    height: 36px;
    line-height: 36px;
    border-radius: 2px;
    text-decoration: none;
    color: #fff;
    text-align: center;
    letter-spacing: .5px;
    cursor: pointer;
    overflow: hidden;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    vertical-align: middle;
    z-index: 1;
    will-change: opacity, transform;
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    -ms-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
    &:hover
      box-shadow: 0 5px 11px 0 rgba(0,0,0,0.18), 0 4px 15px 0 rgba(0,0,0,0.15);
</style>
